schema: '2.0'
stages:
  train:
    cmd: python scripts/train.py --config configs/train.yaml
    deps:
    - path: .env
      hash: md5
      md5: 8078a1f1fcc14c18dc05b37ab0fecaba
      size: 175
    - path: configs/train.yaml
      hash: md5
      md5: 79a70925c1889d00d3391976f9eca8d3
      size: 950
    - path: dataset_split
      hash: md5
      md5: 227624d5fae92ab573537d1c3139312c.dir
      size: 26296402
      nfiles: 430
    - path: scripts/env_loader.py
      hash: md5
      md5: f9b306e0629a69d24a3bf53ce005d0a8
      size: 845
    - path: scripts/train.py
      hash: md5
      md5: 24e301f12ee03b1a077074991952825e
      size: 22349
    params:
      configs/train.yaml:
        data:
          root: ./dataset_split
        gate:
          min_miou: 0.3
          min_oa: 0.5
        mlflow:
          enabled: true
          tracking_uri:
          experiment: u-net-workflow
          run_name:
          tags: {}
          artifact_subdir: artifacts
          model_name: unetpp-seg
          model_stage: Staging
        model:
          encoder_name: resnet34
          encoder_weights:
          decoder_use_batchnorm: true
          in_channels: 4
          num_classes: 6
        paths:
          output_dir: ./outputs
          model_path: outputs/model.pth
          metrics_path: outputs/metrics.json
          log_file: outputs/log.txt
        training:
          img_size: 256
          batch_size: 16
          epochs: 10
          lr: 0.001
          weight_decay: 0.0001
          num_workers: 4
          seed: 42
          amp: true
          save_best: true
          ignore_index: -1
    outs:
    - path: outputs/metrics.json
      hash: md5
      md5: 78c0578dd7b0fbfad444081c82bd18e7
      size: 559
    - path: outputs/model.pth
      hash: md5
      md5: 1894205ae3031abeeeb861a1977a6d4a
      size: 313302533
  evaluate:
    cmd: python scripts/evaluate.py
    deps:
    - path: .env
      hash: md5
      md5: 8078a1f1fcc14c18dc05b37ab0fecaba
      size: 175
    - path: dataset_split
      hash: md5
      md5: 227624d5fae92ab573537d1c3139312c.dir
      size: 26296402
      nfiles: 430
    - path: outputs/model.pth
      hash: md5
      md5: 1894205ae3031abeeeb861a1977a6d4a
      size: 313302533
    - path: scripts/env_loader.py
      hash: md5
      md5: f9b306e0629a69d24a3bf53ce005d0a8
      size: 845
    - path: scripts/evaluate.py
      hash: md5
      md5: ee7b81a10d7012f9dece7627d767d40e
      size: 12178
    outs:
    - path: outputs/eval
      hash: md5
      md5: 8ed167a681f66b447762007acb8ecd10.dir
      size: 302044
      nfiles: 5
  inference:
    cmd: python scripts/inference.py
    deps:
    - path: .env
      hash: md5
      md5: 8078a1f1fcc14c18dc05b37ab0fecaba
      size: 175
    - path: outputs/model.pth
      hash: md5
      md5: 1894205ae3031abeeeb861a1977a6d4a
      size: 313302533
    - path: scripts/env_loader.py
      hash: md5
      md5: f9b306e0629a69d24a3bf53ce005d0a8
      size: 845
    - path: scripts/inference.py
      hash: md5
      md5: 8365effb5830eec82f7a8d2673adc4f7
      size: 12412
    - path: test_img/area_test1.tif
      hash: md5
      md5: 674cf39e0540d5779bdb337a9c625f0d
      size: 5250810
    outs:
    - path: outputs/infer
      hash: md5
      md5: 0d016d89c174ef6ab25a9585396bdbb3.dir
      size: 374730
      nfiles: 6
  gate:
    cmd: python scripts/check_metrics.py --metrics outputs/metrics.json --config
      configs/train.yaml --stamp outputs/gate.ok
    deps:
    - path: .env
      hash: md5
      md5: 8078a1f1fcc14c18dc05b37ab0fecaba
      size: 175
    - path: configs/train.yaml
      hash: md5
      md5: 79a70925c1889d00d3391976f9eca8d3
      size: 950
    - path: outputs/metrics.json
      hash: md5
      md5: 78c0578dd7b0fbfad444081c82bd18e7
      size: 559
    - path: scripts/check_metrics.py
      hash: md5
      md5: d9338d6a4fcec8ca257996e659078ecc
      size: 2640
    - path: scripts/env_loader.py
      hash: md5
      md5: f9b306e0629a69d24a3bf53ce005d0a8
      size: 845
    outs:
    - path: outputs/gate.ok
      hash: md5
      md5: d3accd33402becc720abebee93ebe193
      size: 4
  register:
    cmd: python scripts/register_model.py --metrics outputs/metrics.json 
      --config configs/train.yaml --stamp outputs/register.ok
    deps:
    - path: .env
      hash: md5
      md5: 8078a1f1fcc14c18dc05b37ab0fecaba
      size: 175
    - path: configs/train.yaml
      hash: md5
      md5: 79a70925c1889d00d3391976f9eca8d3
      size: 950
    - path: outputs/gate.ok
      hash: md5
      md5: d3accd33402becc720abebee93ebe193
      size: 4
    - path: outputs/metrics.json
      hash: md5
      md5: 78c0578dd7b0fbfad444081c82bd18e7
      size: 559
    - path: outputs/model.pth
      hash: md5
      md5: 1894205ae3031abeeeb861a1977a6d4a
      size: 313302533
    - path: scripts/env_loader.py
      hash: md5
      md5: f9b306e0629a69d24a3bf53ce005d0a8
      size: 845
    - path: scripts/register_model.py
      hash: md5
      md5: 08f87b6148e3959ade3f5b6aab568642
      size: 3777
    outs:
    - path: outputs/register.ok
      hash: md5
      md5: 9904213016254cc90019b5c284c2fc2e
      size: 14
